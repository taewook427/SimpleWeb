# 간단한 파이썬 코드 일치도 검사기

두 파이썬 코드 간의 유사도를 계산합니다.

다른 곳에 자유롭게 공유하셔도 됩니다.

개선 사항이 있다면 pull request 하십시오.

# 일치도 계산 기준

4개의 계산 기준이 있으며 각 항목별로 가중치가 다릅니다.

각 항목별 일치도는 0 ~ 100%이며, 총 일치도 또한 0 ~ 100%으로 표시됩니다.

### 변수명 (20%)

##### 코드에서 사용하는 변수의 이름을 비교합니다.

변수명/함수명은 다음 조건을 만족하는 연속된 문자열입니다.

```python
1. 코드의 각 행 맨 앞에서 시작하며 단일 "=" 앞에 오는 문자열.
2. "def" 문구 뒤에 오며 "(" 또는 공백 앞에 오는 문자열.
3. "class" 문구 뒤에 오며 "(" 또는 공백 앞에 오는 문자열.
```

탐지된 변수명들은 대문자를 소문자로 바꾸고, 영문이 아닌 다른 글자를 모두 지워 표준화된 상태로 배열에 들어갑니다.

변수명의 개수를 셀 때는 중복된 항목은 제외하고 셉니다.

1번 코드에서 나온 변수명들의 총 개수를 a, 2번 코드에서 나온 변수명들의 총 개수를 b, 공통으로 쓰이는 변수명의 개수를 c라고 하면

변수명 일치도는 2c / (a + b) * 100%으로 계산됩니다.

### 연산자 구조 (30%)

##### 사칙연산 등 코드에서 계산이 이루어지는 부분을 비교합니다.

연산자란 다음 특수문자를 말합니다.

```python
["+", "-", "*", "/", "%", "(", ")", "{", "}", "[", "]", "=", "<", ">", ",", ".", "!", "'", '"']
```

먼저 전처리를 통해 코드 각 행의 공백을 모두 제거하고 연산자만 남게 변환한 결과를 배열에 담습니다.

1번 코드의 결과를 arr1, 2번 코드의 결과를 arr2라고 합니다.

배열의 각 항목에 대해 근처 위아래 2줄 내에 동일한 내용의 연산자 구조가 존재하면 이 항목은 체크됩니다.

체크된 항목의 수를 각각 chk1, chk2라고 합니다.

이때 연산자 구조 일치도는 (chk1 + chk2) / ( len(arr1) + len(arr2) ) * 100%으로 계산됩니다.

### 제어 구조 (30%)

##### 반복문, 조건문, 함수 등 코드의 제어 흐름을 비교합니다.

제어 흐름 계산은 다음 키워드를 감지하여 결정합니다.

```python
1. 콜론 [":"]
2. 제어 토큰 ["def", "class", "while", "for", "if", "elif", "else"]
```

제어 토큰은 콜론이 있는 행에 존재합니다.

코드의 행을 분석해 제어 구조 배열을 생성합니다.

이때 배열의 각 항목은 같은 인덱스의 코드 행에 따라 결정됩니다.

코드에 콜론이 없으면 빈 문자열이 들어갑니다.

콜론이 존재한다면 어느 제어 토큰이 포함되었는지 표시하는 문자열이 들어갑니다.

이 제어 구조 배열들을 각각 arr1, arr2라고 합니다.

빈 문자열로 시작하지 않는 연속된 5개의 배열 항목을 chunk라고 합니다.

각 배열별 청크의 개수를 각각 cnum1, cnum2라고 합니다.

각 chunk별로 다른 배열에 동일한 내용의 chunk가 존재한다면 이 chunk는 체크됩니다.

각 배열의 체크된 청크의 수를 chk1, chk2라고 합니다.

이때 제어 구조 일치도는 (chk1 + chk2) / (cnum1 + cnum2) * 100%으로 계산됩니다.

### 자체 동일성 (20%)

##### 기타 다른 코드 텍스트가 그대로 사용된 비율을 사용해 비교합니다.

먼저 전처리를 통해 코드 각 행의 공백과 탭, 비어있는 행을 모두 제거하고 변환한 결과를 배열에 담습니다.

이 배열을 각각 arr1, arr2라고 합니다.

배열의 각 항목마다 다른 배열의 항목과 비교하여 가장 긴 공통 부분의 길이를 구합니다.

배열의 모든 항목에 이 길이를 항목 문자열의 길이로 나눈 값(ratio)을 부여합니다.

자체 동일성 일치도는 (배열의 모든 ratio의 평균) * 100%으로 계산됩니다.
